<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log in - SHOEPAO</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <img src="IMAGE/SHOEPAOLOGO.png" alt="SHOEPAO Logo" class="logo" style="margin-bottom:6px;">
    <h3 class="site-name" style="margin:4px 0 8px 0;font-size:2.4rem;color:#000;font-weight:700;">Shoe Pao</h3>
        <h2 class="login-header" style="font-size:1.2rem;margin-bottom:6px;">Log in</h2>
        <div class="subheader">Don't have an account? <a href="signup.html" class="signup-link">Sign up</a></div>
    <form id="loginForm" class="login-form" autocomplete="off" onsubmit="handleLogin(event)">
            <label for="email" class="input-label">Your email</label>
            <input type="email" id="email" name="email" class="input-box" required>

            <div class="password-row">
                <div class="password-label-row">
                    <label for="password" class="input-label">Your password</label>
                    <span class="toggle-password" onclick="togglePassword()" id="toggleIcon"><span class="eye-icon">&#128065;</span> Hide</span>
                </div>
                <input type="password" id="password" name="password" class="input-box" required>
            </div>
            <div class="forgot-row">
                <a href="#" class="forgot-link">Forget your password</a>
            </div>
            <div id="loginError" style="color:#b71c1c;margin:8px 0;display:none"></div>
            <button type="submit" class="login-btn">Log in</button>
        </form>
    </div>
    <script>
        // Simple client-side credential storage for demo purposes.
        // NOTE: This is not secure for real apps. For production use server-side auth.
        (function(){
            try{
                var users = JSON.parse(localStorage.getItem('users')||'null');
                if(!Array.isArray(users)){
                    users = [
                        { email: 'jemar@gmail.com', password: 'password', role: 'user' },
                        { email: 'admin@gmail.com', password: 'admin', role: 'admin' }
                    ];
                    localStorage.setItem('users', JSON.stringify(users));
                }
            }catch(e){ /* ignore */ }
        })();

        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('toggleIcon');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.innerHTML = '<span class="eye-icon">&#128065;</span> Show';
            } else {
                passwordInput.type = 'password';
                toggleIcon.innerHTML = '<span class="eye-icon">&#128065;</span> Hide';
            }
        }

        function getQueryParam(name) {
            try{ var params = new URLSearchParams(window.location.search); return params.get(name); }catch(e){ return null; }
        }

        function handleLogin(e){
            e.preventDefault();
            var email = (document.getElementById('email').value||'').trim();
            var password = (document.getElementById('password').value||'');
            var errEl = document.getElementById('loginError'); errEl.style.display='none'; errEl.textContent='';
            if(!email || !password){ errEl.style.display='block'; errEl.textContent='Please enter email and password.'; return; }
            // Allow any credentials for now. Assign admin role only when email matches admin@gmail.com
            var role = (email.trim().toLowerCase() === 'admin@gmail.com') ? 'admin' : 'user';
            // Try to find a matching user entry to populate full profile fields (name, phone, address)
            var users = [];
            try{ users = JSON.parse(localStorage.getItem('users') || '[]') || []; }catch(e){ users = []; }
            var matched = users.find(function(u){ return (u.email||'').toLowerCase() === email.trim().toLowerCase(); }) || null;
            var profile = { email: email.trim().toLowerCase(), role: role, loggedAt: Date.now(), remember: true };
            if(matched){
                // prefer explicit name fields, then first/last
                profile.name = matched.name || ((matched.firstName||'') + (matched.lastName ? (' ' + matched.lastName) : '')).trim() || '';
                profile.firstName = matched.firstName || '';
                profile.lastName = matched.lastName || '';
                profile.phone = matched.phone || '';
                profile.addressMain = matched.addressMain || '';
                profile.addressDetails = matched.addressDetails || '';
            }
            try{
                // keep the active profile in sessionStorage so it does not persist across browser restarts
                sessionStorage.setItem('profile', JSON.stringify(profile));
                sessionStorage.setItem('profile_updated_at', String(Date.now()));
            }catch(e){}
            // If a return URL was provided, go back there, otherwise use home/dashboard
            var ret = getQueryParam('return');
            if(ret) {
                try{ window.location.href = decodeURIComponent(ret); return; } catch(e) {}
            }
            if(role === 'admin') window.location.href = 'dashboard.html'; else window.location.href = 'home.html';
        }
    </script>
</body>
</html>
