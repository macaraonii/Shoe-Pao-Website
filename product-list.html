<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - SHOEPAO</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .productlist-sidebar {
            min-width: 220px;
            max-width: 260px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            /* overflow-y: auto; */
            /* max-height: 340px; */
            padding-right: 8px;
            margin-bottom: 0;
        }
        .sidebar-header {
            font-size: 1.18rem;
            font-weight: 600;
            color: #222;
            margin-bottom: 18px;
        }
        .gender-checkbox-row {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 18px;
        }
        .gender-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.05rem;
            font-weight: 500;
            color: #222;
        }
        .sidebar-divider {
            width: 80%;
            height: 2px;
            background: #eee;
            margin: 18px 0 12px 0;
        }
        .sidebar-size-header {
            font-size: 1.08rem;
            font-weight: 600;
            color: #222;
            margin-bottom: 14px;
        }
        .size-btn-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .size-btn {
            background: #fff;
            color: #222;
            border: 2px solid #ccc;
            border-radius: 18px;
            padding: 8px 18px;
            font-size: 1.05rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.18s, color 0.18s, border-color 0.18s;
            width: 56px;
            height: 38px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .size-btn.active {
            background: #222;
            color: #fff;
            border-color: #222;
        }
        .size-btn {
            background: #fff;
            color: #222;
            border: 2px solid #ccc;
            border-radius: 18px;
            padding: 8px 18px;
            font-size: 1.05rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s, color 0.2s, border 0.2s;
        }
        .size-btn.active {
            background: #222;
            color: #fff;
            border-color: #222;
        }
        .productlist-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 32px;
            min-width: 0;
        }
        .productlist-caption-row {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 32px;
            margin-top: 0;
            width: 100%;
        }
        .productlist-caption {
            font-size: 1.18rem;
            font-weight: 400;
            color: #222;
        }
        .productlist-caption .brand {
            font-weight: 700;
        }
        .productlist-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 32px;
            width: 100%;
            max-width: 900px;
        }
        .shoe-card {
            background: none;
            border: none;
            width: 260px;
            display: flex;
            flex-direction: column;
            gap: 0;
        }
        .shoe-img-box {
            position: relative;
            width: 260px;
            height: 170px;
            border-radius: 0;
            overflow: hidden;
        }
        .shoe-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .badge-new {
            position: absolute;
            top: 16px;
            left: 16px;
            background: #222;
            color: #fff;
            font-size: 0.98rem;
            font-weight: 500;
            border-radius: 12px;
            padding: 4px 18px;
            z-index: 2;
        }
        .badge-sale {
            position: absolute;
            top: 16px;
            left: 16px;
            background: #b71c1c;
            color: #fff;
            font-size: 0.98rem;
            font-weight: 500;
            border-radius: 12px;
            padding: 4px 14px;
            z-index: 2;
        }
        .flip-horizontal {
            transform: scaleX(-1);
            transform-origin: center;
        }
        .shoe-info-box {
            background: #f7f7f7;
            border-radius: 0;
            padding: 16px 18px 12px 18px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .shoe-info-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.08rem;
            font-weight: 500;
            color: #222;
        }
        .shoe-brand {
            font-weight: 600;
        }
        .shoe-price {
            font-weight: 500;
            color: #222;
        }
        .shoe-price-old {
            text-decoration: line-through;
            color: #888;
            margin-right: 8px;
            font-size: 0.98rem;
        }
    </style>
</head>
<body class="productlist-body" style="min-height:100vh;display:flex;flex-direction:column;">
    <!-- Navigation Bar (copied from home.html) -->
    <nav class="homepage-header" style="position:sticky;top:0;z-index:100;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.04);padding:0 40px;display:flex;align-items:center;justify-content:space-between;height:72px;padding-left:46px;">
    <div style="display:flex;align-items:center;gap:24px;">
            <a href="home.html" style="display:flex;align-items:center;gap:30px;text-decoration:none;color:inherit;">
                <img src="IMAGE/SHOEPAOLOGO.png" alt="SHOEPAO Logo" style="height:42px;width:auto;cursor:pointer;">
                <span class="header-caption" style="font-size:1.18rem;font-weight:600;color:#b71c1c;cursor:pointer;">Shoe Pao Footwear</span>
            </a>
            <span class="header-link" onclick="goToSale()">Sale</span>
            <span class="header-link" onclick="goToNewArrivals()">New Arrivals</span>
            <span class="header-link" id="brandNavPL">Brands
                <div class="brand-dropdown" id="brandDropdownPL" aria-hidden="true">
                    <a href="product-list.html?brand=Nike" class="brand-drop-link" onclick="event.preventDefault(); applyBrand('Nike')"><img src="IMAGE/NIKELOGO.png" alt="Nike" style="height:28px;"></a>
                    <a href="product-list.html?brand=Adidas" class="brand-drop-link" onclick="event.preventDefault(); applyBrand('Adidas')"><img src="IMAGE/ADIDASLOGO.png" alt="Adidas" style="height:28px;"></a>
                    <a href="product-list.html?brand=Cloudtilt" class="brand-drop-link" onclick="event.preventDefault(); applyBrand('Cloudtilt')"><img src="IMAGE/CLOUDTILTLOGO.png" alt="Cloudtilt" style="height:28px;"></a>
                    <a href="product-list.html?brand=New%20Balance" class="brand-drop-link" onclick="event.preventDefault(); applyBrand('New Balance')"><img src="IMAGE/NEWBALANCELOGO.png" alt="New Balance" style="height:28px;"></a>
                </div>
            </span>
            <style>
                /* ensure brand dropdown anchors under nav item */
                #brandNavPL { position: relative; }
                /* match home page: horizontal brand icons */
                #brandDropdownPL { display: none; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); background: #fff; color: #222; border: 1px solid #eee; padding: 8px 10px; border-radius: 6px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); z-index: 120; white-space: nowrap; text-align: center; }
                .brand-drop-link { display: inline-block; margin: 4px 8px; }
            </style>
            <span class="header-link" onclick="goToProductList()">Shop All</span>
        </div>
        <div style="display:flex;align-items:center;gap:18px;">
            <button class="header-icon-btn" onclick="toggleSearchBox()" style="background:none;border:none;padding:6px;display:flex;align-items:center;cursor:pointer;"><img src="IMAGE/SEARCHICON.png" class="header-icon" alt="Search" style="width:26px;height:26px;"></button>
            <button class="header-icon-btn" onclick="goToUserPage()" style="background:none;border:none;padding:6px;display:flex;align-items:center;cursor:pointer;"><img src="IMAGE/USERICON.png" class="header-icon" alt="User" style="width:26px;height:26px;"></button>
            <button class="header-icon-btn" id="cartToggleBtn" style="background:none;border:none;padding:6px;display:flex;align-items:center;cursor:pointer;"><img src="IMAGE/CARTICON.png" class="header-icon" alt="Cart" style="width:26px;height:26px;"></button>
        </div>
        <div class="search-box" id="searchBox" style="display:none;position:absolute;top:72px;right:80px;background:#fff;border:1px solid #ccc;border-radius:8px;padding:8px 16px;z-index:101;">
            <input type="text" class="search-input" id="searchInput" placeholder="Search products..." onkeydown="searchKeyDown(event)" style="font-family:'Poppins',Arial,sans-serif;font-size:1rem;border:none;outline:none;width:220px;padding:6px 0;">
        </div>
    </nav>
    <main class="productlist-main-content" style="flex:1 1 auto;padding-top:20px;">
        <div class="site-container">
        <div class="productlist-main">
            <!-- Sidebar -->
            <aside class="productlist-sidebar" style="padding-left:24px;">
                <div class="sidebar-section">
                    <div class="sidebar-header" style="font-size:1.18rem;font-weight:600;color:#222;margin-bottom:18px;">Gender</div>
                    <div class="gender-checkbox-row" style="display:flex;flex-direction:column;gap:10px;margin-bottom:18px;">
                        <label class="gender-checkbox" style="display:flex;align-items:center;gap:8px;font-size:1.05rem;font-weight:500;color:#222;">
                            <input type="checkbox" id="genderMen" checked onchange="applyAllFilters()" style="accent-color:#000;width:18px;height:18px;">
                            <span style="color:#222;">Men</span>
                        </label>
                        <label class="gender-checkbox" style="display:flex;align-items:center;gap:8px;font-size:1.05rem;font-weight:500;color:#222;">
                            <input type="checkbox" id="genderWomen" checked onchange="applyAllFilters()" style="accent-color:#000;width:18px;height:18px;">
                            <span style="color:#222;">Women</span>
                        </label>
                        <label class="gender-checkbox" style="display:flex;align-items:center;gap:8px;font-size:1.05rem;font-weight:500;color:#222;">
                            <input type="checkbox" id="genderUnisex" checked onchange="applyAllFilters()" style="accent-color:#000;width:18px;height:18px;">
                            <span style="color:#222;">Unisex</span>
                        </label>
                    </div>
                    <div style="margin-top:6px;margin-bottom:8px;">
                        <div class="sidebar-header" style="font-size:1.08rem;font-weight:600;color:#222;margin-bottom:8px;">Brands</div>
                        <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:8px;">
                            <label class="gender-checkbox"><input type="checkbox" class="brand-checkbox" id="brandNike" value="Nike" checked onchange="applyAllFilters()" style="accent-color:#000;width:18px;height:18px;margin-right:8px;"> Nike</label>
                            <label class="gender-checkbox"><input type="checkbox" class="brand-checkbox" id="brandAdidas" value="Adidas" checked onchange="applyAllFilters()" style="accent-color:#000;width:18px;height:18px;margin-right:8px;"> Adidas</label>
                            <label class="gender-checkbox"><input type="checkbox" class="brand-checkbox" id="brandCloudtilt" value="Cloudtilt" checked onchange="applyAllFilters()" style="accent-color:#000;width:18px;height:18px;margin-right:8px;"> Cloudtilt</label>
                            <label class="gender-checkbox"><input type="checkbox" class="brand-checkbox" id="brandNewBalance" value="New Balance" checked onchange="applyAllFilters()" style="accent-color:#000;width:18px;height:18px;margin-right:8px;"> New Balance</label>
                        </div>
                    </div>
                    <div class="sidebar-divider" style="width:80%;height:2px;background:#eee;margin:18px 0 12px 0;"></div>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-size-header" style="font-size:1.08rem;font-weight:600;color:#222;margin-bottom:14px;">Size</div>
                    <div class="size-control" style="display:flex;flex-direction:column;gap:8px;">
                        <div style="display:flex;gap:8px;align-items:center;">
                            <label style="font-weight:600;margin-right:8px;font-size:1rem;color:#222;">Size Standard:</label>
                            <button id="euBtn" class="size-standard-btn" style="padding:6px 12px;border-radius:8px;border:1px solid #222;background:#222;color:#fff;font-weight:600;">EU</button>
                            <button id="usBtn" class="size-standard-btn" style="padding:6px 12px;border-radius:8px;border:1px solid #ccc;background:#fff;color:#222;">US</button>
                        </div>
                        <div class="size-btn-row" id="sizeBtnRow" style="display:flex;flex-wrap:wrap;gap:10px;"></div>
                    </div>
                </div>
            </aside>
            <!-- Main Content -->
            <section class="productlist-content">
                <div class="productlist-caption-row" id="productlist-caption-row" style="margin-bottom:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;">
                    <span id="productlist-caption" class="productlist-caption" style="text-align:center;display:block;min-height:1.2em;"></span>
                    <button id="clearSearchBtn" aria-label="Clear search" style="display:none;background:transparent;border:none;color:#222;cursor:pointer;font-size:0.95rem;display:flex;align-items:center;gap:8px;padding:6px 10px;">
                        <span style="width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;">✕</span>
                        <span>Clear search</span>
                    </button>
                </div>
                <div class="productlist-grid" id="productGrid">
                    <div class="shoe-card" data-gender="Men" data-size="8" style="cursor:pointer;" onclick="viewProduct('Nike','Nike Airmax TN Aqua Blue','P1,299.00','IMAGE/NIKE1.png','New')">
                        <div class="shoe-img-box">
                            <img src="IMAGE/NIKE1.png" class="shoe-img flip-horizontal" alt="Nike Airmax TN Aqua Blue">
                            <span class="badge-new">New</span>
                        </div>
                        <div class="shoe-info-box">
                            <div class="shoe-info-top">
                                <span class="shoe-brand">Nike</span>
                                <span class="shoe-price">P1,299.00</span>
                            </div>
                            <div class="shoe-info-bottom">Nike Airmax TN Aqua Blue</div>
                        </div>
                    </div>
                    <div class="shoe-card" data-gender="Men" data-size="9" style="cursor:pointer;" onclick="viewProduct('Nike','Nike Airmax Black','P2,395.00','IMAGE/NIKE2.png','New')">
                        <div class="shoe-img-box">
                            <img src="IMAGE/NIKE2.png" class="shoe-img flip-horizontal" alt="Nike Airmax Black">
                            <span class="badge-new">New</span>
                        </div>
                        <div class="shoe-info-box">
                            <div class="shoe-info-top">
                                <span class="shoe-brand">Nike</span>
                                <span class="shoe-price">P2,395.00</span>
                            </div>
                            <div class="shoe-info-bottom">Nike Airmax Black</div>
                        </div>
                    </div>
                    <div class="shoe-card" data-gender="Women" data-size="7" style="cursor:pointer;" onclick="viewProduct('Nike','Nike GT CUT 2 LEAP HIGH','P1,999.00','IMAGE/NIKE3.png','New')">
                        <div class="shoe-img-box">
                            <img src="IMAGE/NIKE3.png" class="shoe-img flip-horizontal" alt="Nike GT CUT 2 LEAP HIGH">
                        </div>
                        <div class="shoe-info-box">
                            <div class="shoe-info-top">
                                <span class="shoe-brand">Nike</span>
                                <span class="shoe-price-old">P2,395.00</span><span class="shoe-price">P1,999.00</span>
                            </div>
                            <div class="shoe-info-bottom">Nike GT CUT 2 LEAP HIGH</div>
                        </div>
                    </div>
                    <div class="shoe-card" data-gender="Women" data-size="8" style="cursor:pointer;" onclick="viewProduct('Nike','Nike Airmax White','P2,199.00','IMAGE/NIKE4.png','New')">
                        <div class="shoe-img-box">
                            <img src="IMAGE/NIKE4.png" class="shoe-img flip-horizontal" alt="Nike Airmax White">
                        </div>
                        <div class="shoe-info-box">
                            <div class="shoe-info-top">
                                <span class="shoe-brand">Nike</span>
                                <span class="shoe-price">P2,199.00</span>
                            </div>
                            <div class="shoe-info-bottom">Nike Airmax White</div>
                        </div>
                    </div>
                    <div class="shoe-card" data-gender="Men" data-size="10" style="cursor:pointer;" onclick="viewProduct('Nike','Nike Airmax Red','P2,299.00','IMAGE/NIKE5.png','New')">
                        <div class="shoe-img-box">
                            <img src="IMAGE/NIKE5.png" class="shoe-img flip-horizontal" alt="Nike Airmax Red">
                        </div>
                        <div class="shoe-info-box">
                            <div class="shoe-info-top">
                                <span class="shoe-brand">Nike</span>
                                <span class="shoe-price">P2,299.00</span>
                            </div>
                            <div class="shoe-info-bottom">Nike Airmax Red</div>
                        </div>
                    </div>
                    <!-- Sale items added from Home -> Sale -->
                    <div class="shoe-card" data-gender="Women" data-size="8" style="cursor:pointer;" onclick="viewProduct('Cloudtilt','Cloudtilt Iron Dew Womens','P1,299.00','IMAGE/SALESSHOE1.png','Sale')">
                        <div class="shoe-img-box">
                            <img src="IMAGE/SALESSHOE1.png" class="shoe-img" alt="Cloudtilt Iron Dew Womens">
                            <span class="badge-sale">Sale</span>
                        </div>
                        <div class="shoe-info-box">
                            <div class="shoe-info-top">
                                <span class="shoe-brand">Cloudtilt</span>
                                <span><span class="shoe-price-old">P2,295.00</span><span class="shoe-price">P1,299.00</span></span>
                            </div>
                            <div class="shoe-info-bottom">Cloudtilt Iron Dew Womens</div>
                        </div>
                    </div>
                    <div class="shoe-card" data-gender="Men" data-size="9" style="cursor:pointer;" onclick="viewProduct('New Balance','New Balance 530','P1,299.00','IMAGE/SALESSHOE2.png','Sale')">
                        <div class="shoe-img-box">
                            <img src="IMAGE/SALESSHOE2.png" class="shoe-img" alt="New Balance 530">
                            <span class="badge-sale">Sale</span>
                        </div>
                        <div class="shoe-info-box">
                            <div class="shoe-info-top">
                                <span class="shoe-brand">New Balance</span>
                                <span><span class="shoe-price-old">P2,295.00</span><span class="shoe-price">P1,299.00</span></span>
                            </div>
                            <div class="shoe-info-bottom">New Balance 530</div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        </div>
    </main>
    
    <script>
    // Header nav helpers (product-list)
    function goToSale(){ window.location.href = 'product-list.html?filter=sale'; }
    function goToNewArrivals(){ window.location.href = 'product-list.html?filter=new'; }
    // Brand dropdown toggle for product-list header
    document.addEventListener('DOMContentLoaded', function(){
        var brandNav = document.getElementById('brandNavPL');
        var brandDropdown = document.getElementById('brandDropdownPL');
        if(!brandNav || !brandDropdown) return;
        brandNav.addEventListener('click', function(e){
            e.stopPropagation();
            var showing = brandDropdown.style.display === 'block';
            brandDropdown.style.display = showing ? 'none' : 'block';
        });
        document.addEventListener('click', function(){ brandDropdown.style.display = 'none'; });

        // Read URL params and pre-filter cards if needed
    var params = new URLSearchParams(window.location.search);
    var qBrand = params.get('brand');
    var qFilter = params.get('filter');

    function applyUrlFilters(){
            // hide the large Brands section when a specific filter/brand is active
            var brandsSection = document.getElementById('brands');
            if(brandsSection && (qBrand || qFilter)) brandsSection.style.display = 'none';

            // apply card filtering
            var cards = Array.from(document.querySelectorAll('.shoe-card'));
            var visibleCount = 0;
            cards.forEach(function(card){
                var keep = true;
                if(qBrand){
                    var b = (card.getAttribute('data-brand')||'').toLowerCase();
                    if(b !== qBrand.toLowerCase()) keep = false;
                }
                if(qFilter === 'sale'){
                    var badge = card.querySelector('.badge-sale');
                    if(!badge) keep = false;
                }
                if(qFilter === 'new'){
                    var badge = card.querySelector('.badge-new');
                    if(!badge) keep = false;
                }
                card.style.display = keep ? '' : 'none';
                if(keep) visibleCount++;
            });

            // show no-results message if nothing matched
            var content = document.querySelector('.productlist-content');
            if(!content) return;
            var existing = document.querySelector('.no-results-message');
            if(existing) existing.remove();
            if(visibleCount === 0){
                var msg = 'No matching products';
                if(qFilter === 'sale') msg = 'No shoes on Sale';
                else if(qFilter === 'new') msg = 'No New Arrivals';
                else if(qBrand) msg = 'No ' + qBrand + ' shoes';
                var el = document.createElement('div');
                el.className = 'no-results-message';
                el.style.padding = '28px';
                el.style.color = '#666';
                el.style.fontSize = '1.05rem';
                el.textContent = msg;
                content.insertBefore(el, content.firstChild);
            }
        }

        function runInitialFilters(){
            // prefer brand-specific filtering if a brand param is present
            if(qBrand){
                // run after a brief delay to ensure cards rendered
                setTimeout(function(){ try{ applyBrand(qBrand); }catch(e){ applyUrlFilters(); } }, 150);
                return;
            }
            if(qFilter){
                setTimeout(applyUrlFilters, 150);
            }
        }

        // run initial filters when page loads
        runInitialFilters();
    });
    </script>
    <script>
    function viewProduct(brand, name, price, img, badge) {
        localStorage.setItem('productBrand', brand);
        localStorage.setItem('productTitle', name);
        localStorage.setItem('productPrice', price);
        localStorage.setItem('productImg', img);
        localStorage.setItem('productBadge', badge);
        window.location.href = 'product-view.html';
    }
    // Add to Cart button logic
    document.addEventListener('DOMContentLoaded', function() {
    });
    // Navigation bar functions (copied from home.html)
    function goToHomeTop() { window.location.href = 'home.html#top'; }
    function goToSale() { window.location.href = 'product-list.html?filter=sale'; }
    function goToNewArrivals() { window.location.href = 'product-list.html?filter=new'; }
    function goToBrands() { window.location.href = 'product-list.html'; }
    function goToProductList() { window.location.href = 'product-list.html'; }
    function goToUserPage() { window.location.href = 'profile.html'; }
    function goToCartPage() { window.location.href = 'cart.html'; }
    function toggleSearchBox() {
        var box = document.getElementById('searchBox');
        box.style.display = (box.style.display === 'block') ? 'none' : 'block';
        if (box.style.display === 'block') {
            document.getElementById('searchInput').focus();
        }
    }
    function searchKeyDown(e) {
        if (e.key === 'Enter') {
            var val = document.getElementById('searchInput').value.trim();
            if (val) {
                window.location.href = 'product-list.html?search=' + encodeURIComponent(val);
            }
        }
    }
    // Gender filter: delegate to unified filter so all controls combine correctly
    function filterGender() {
        applyAllFilters();
    }

    // Apply a brand filter from the header dropdown or elsewhere.
    // This will check the corresponding brand checkbox, uncheck others, and run the unified filter.
    function applyBrand(brand){
        try{
            if(!brand) return;
            var boxes = Array.from(document.querySelectorAll('.brand-checkbox'));
            var found = false;
            boxes.forEach(function(b){
                if(!b) return;
                if(String(b.value || '').toLowerCase() === String(brand||'').toLowerCase()){ b.checked = true; found = true; }
                else b.checked = false;
            });
            // if no brand checkboxes exist (or none matched), just perform a search-like filter
            if(!found){
                // mark search box and clear other filters
                try{ var si = document.getElementById('searchInput'); if(si) si.value = '';}catch(e){}
            }
            // hide dropdown if present
            try{ var dd = document.getElementById('brandDropdownPL'); if(dd) dd.style.display = 'none'; }catch(e){}
            // apply unified filters to update visible cards
            if(typeof applyAllFilters === 'function') applyAllFilters();
            // update URL param for shareability (without reload)
            try{
                var url = new URL(window.location.href);
                url.searchParams.set('brand', brand);
                window.history.replaceState({}, '', url.pathname + url.search + url.hash);
            }catch(e){}
        }catch(e){ console.error('applyBrand failed', e); }
    }
    // Size filter + EU/US toggle with persistent selected sizes (stored as EU internally)
    (function(){
        const EU_SIZES = ['36','37','38','39','40','41','42','43','44','45'];
        const US_SIZES = ['5','5.5','6.5','7','7.5','8','8.5','9.5','10','11'];
        const US_TO_EU = { '5':'36','5.5':'37','6.5':'38','7':'39','7.5':'40','8':'41','8.5':'42','9.5':'43','10':'44','11':'45' };
        const EU_TO_US = Object.fromEntries(Object.entries(US_TO_EU).map(([u,e])=>[e,u]));

        function getStandard(){ return localStorage.getItem('sizeStandard') || 'EU'; }
        function setStandard(v){ localStorage.setItem('sizeStandard', v); }

        // selected sizes are stored as an array of EU sizes in localStorage.selectedEU
        function getSelectedEU(){ try{ return JSON.parse(localStorage.getItem('selectedEU') || '[]'); }catch(e){ return []; } }
        function setSelectedEU(arr){ localStorage.setItem('selectedEU', JSON.stringify(Array.from(new Set(arr)))); }
        function toggleSelectedEU(eu){ const cur = new Set(getSelectedEU()); if(cur.has(eu)) cur.delete(eu); else cur.add(eu); setSelectedEU([...cur]); }

        const euBtn = document.getElementById('euBtn');
        const usBtn = document.getElementById('usBtn');
        const sizeBtnRow = document.getElementById('sizeBtnRow');

        function clearSizeButtons(){ sizeBtnRow.innerHTML = ''; }

        function renderSizeButtons(){
            clearSizeButtons();
            const std = getStandard();
            const sizes = (std === 'EU') ? EU_SIZES : US_SIZES;
            const selectedEU = new Set(getSelectedEU());
            sizes.forEach(sz => {
                const b = document.createElement('button');
                b.className = 'size-btn';
                b.textContent = sz;
                b.dataset.size = sz;
                // determine the EU equivalent for this button
                const eu = (std === 'EU') ? sz : (US_TO_EU[sz] || null);
                if(eu && selectedEU.has(eu)) b.classList.add('active');
                b.addEventListener('click', function(){
                    if(!eu) return;
                    toggleSelectedEU(eu);
                    // re-render to keep visual state consistent across standards
                    renderSizeButtons();
                    applyAllFilters();
                });
                sizeBtnRow.appendChild(b);
            });
            // style standard buttons
            if(getStandard() === 'EU'){
                euBtn.style.background = '#222'; euBtn.style.color = '#fff'; euBtn.style.borderColor = '#222';
                usBtn.style.background = '#fff'; usBtn.style.color = '#222'; usBtn.style.borderColor = '#ccc';
            } else {
                usBtn.style.background = '#222'; usBtn.style.color = '#fff'; usBtn.style.borderColor = '#222';
                euBtn.style.background = '#fff'; euBtn.style.color = '#222'; euBtn.style.borderColor = '#ccc';
            }
        }

        euBtn.addEventListener('click', function(){ setStandard('EU'); renderSizeButtons(); applyAllFilters(); });
        usBtn.addEventListener('click', function(){ setStandard('US'); renderSizeButtons(); applyAllFilters(); });

        function getCardProductInfo(card){
            let brand = card.getAttribute('data-brand') || '';
            let title = card.getAttribute('data-title') || '';
            if(!brand || !title){
                const onclick = card.getAttribute('onclick') || '';
                const m = onclick.match(/viewProduct\(\s*'([^']*)'\s*,\s*'([^']*)'/);
                if(m){ brand = brand || m[1]; title = title || m[2]; }
            }
            return { brand: (brand||'').trim(), title: (title||'').trim() };
        }

        // ===== ADDED: default seed inventory for first-time visitors =====
        // If a visitor hasn't visited the admin `inventory.html` page yet,
        // localStorage.inventory may be empty. Seed it here so product-list
        // shows stock and admin-posted items to first-time visitors.
        var defaultInventorySeed = [
            { id:'#P001', name:'Nike Airmax TN Aqua Blue', brand:'Nike', color:'Aqua Blue', image:'IMAGE/NIKE1.png', sizes:{'36':6,'37':8,'38':4,'39':10,'40':6,'41':5,'42':3,'43':2,'44':1,'45':0}, price:1299 },
            { id:'#P002', name:'Nike Airmax Black', brand:'Nike', color:'Black', image:'IMAGE/NIKE2.png', sizes:{'36':4,'37':2,'38':10,'39':6,'40':7,'41':8,'42':2,'43':11,'44':7,'45':3}, price:2395 },
            { id:'#P003', name:'Nike GT CUT 2 LEAP HIGH', brand:'Nike', color:'Multicolor', image:'IMAGE/NIKE3.png', sizes:{'36':2,'37':3,'38':6,'39':5,'40':4,'41':3,'42':2,'43':1,'44':0,'45':0}, price:1999 },
            { id:'#P004', name:'Nike Airmax White', brand:'Nike', color:'White', image:'IMAGE/NIKE4.png', sizes:{'36':6,'37':5,'38':4,'39':6,'40':5,'41':4,'42':3,'43':2,'44':1,'45':0}, price:2199 },
            { id:'#P005', name:'Nike Airmax Red', brand:'Nike', color:'Red', image:'IMAGE/NIKE5.png', sizes:{'36':3,'37':4,'38':5,'39':6,'40':7,'41':6,'42':5,'43':4,'44':3,'45':2}, price:2299 },
            { id:'#P006', name:'Cloudtilt Iron Dew Womens', brand:'Cloudtilt', color:'Iridescent', image:'IMAGE/SALESSHOE1.png', sizes:{'36':5,'37':6,'38':7,'39':8,'40':4,'41':2,'42':1,'43':0,'44':0,'45':0}, price:1299 },
            { id:'#P007', name:'New Balance 530', brand:'New Balance', color:'Silver', image:'IMAGE/SALESSHOE2.png', sizes:{'36':6,'37':12,'38':2,'39':10,'40':4,'41':5,'42':5,'43':1,'44':2,'45':5}, price:1299 }
        ];
        try{
            // Merge seed into existing localStorage.inventory so product-list and admin inventory align
            var _inv = JSON.parse(localStorage.getItem('inventory')||'null');
            if(!Array.isArray(_inv)) _inv = [];
            defaultInventorySeed.forEach(function(s){
                var exists = _inv.find(function(i){ if(!i) return false; if(i.id && s.id && i.id===s.id) return true; var iname=(i.name||'').toString().trim().toLowerCase(); var sname=(s.name||'').toString().trim().toLowerCase(); return iname && sname && iname===sname; });
                if(!exists) _inv.push(Object.assign({}, s));
            });
            if(_inv.length === 0) _inv = defaultInventorySeed.slice();
            localStorage.setItem('inventory', JSON.stringify(_inv));
        }catch(e){}


        function findInventoryForProduct(product){
            try{
                const inv = JSON.parse(localStorage.getItem('inventory') || '[]');
                if(!Array.isArray(inv)) return null;
                const title = (product.title||'').trim();
                const brand = (product.brand||'').trim();
                let found = inv.find(i => (i.name||'').toString().trim() === title);
                if(!found) found = inv.find(i => title && (i.name||'').toString().toLowerCase().indexOf(title.toLowerCase()) !== -1);
                if(!found && brand) found = inv.find(i => (i.brand||'').toString().toLowerCase() === brand.toLowerCase());
                return found || null;
            }catch(e){ return null; }
        }

        // Render inventory items (admin-posted) into the product grid
        function renderInventoryCards(){
            try{
                var grid = document.getElementById('productGrid');
                if(!grid) return;
                var inv = JSON.parse(localStorage.getItem('inventory') || '[]');
                if(!Array.isArray(inv)) return;
                // append each inventory item if not already present (by data-id)
                inv.forEach(function(item){
                    if(!item || !item.id) return;
                    // avoid duplicates
                    if(grid.querySelector('.shoe-card[data-id="'+item.id+'"]')) return;
                    var card = document.createElement('div');
                    card.className = 'shoe-card';
                    card.setAttribute('data-id', item.id);
                    if(item.gender) card.setAttribute('data-gender', item.gender);
                    // choose a size attribute for display (first available or 8)
                    var displaySize = '';
                    if(item.sizes){ for(var s in item.sizes){ if(Number(item.sizes[s])>0){ displaySize = s; break; } } }
                    if(displaySize) card.setAttribute('data-size', displaySize);
                    card.style.cursor = 'pointer';
                    var priceText = 'P' + Number(item.price||0).toLocaleString(undefined,{minimumFractionDigits:2});
                    var imgSrc = (item.image) ? item.image : 'IMAGE/NIKE1.png';
                    var badge = item.badge || '';
                    // build inner HTML
                    var badgeHtml = badge ? '<span class="badge-new">'+badge+'</span>' : '';
                    var flipClass = (item.brand && item.brand.toString().toLowerCase().indexOf('nike')!==-1) ? ' flip-horizontal' : '';
                    var infoTopPrice = '<span class="shoe-brand">'+(item.brand||'')+'</span><span class="shoe-price">'+priceText+'</span>';
                    var inner = '<div class="shoe-img-box"><img src="'+imgSrc+'" class="shoe-img'+flipClass+'" alt="'+(item.name||'Product')+'">'+(badge?('<span class="badge-sale">'+badge+'</span>'):'')+'</div>'+
                                '<div class="shoe-info-box"><div class="shoe-info-top">'+infoTopPrice+'</div><div class="shoe-info-bottom">'+(item.name||'')+'</div></div>';
                    card.innerHTML = inner;
                    // onclick to view product
                    card.addEventListener('click', function(){
                        viewProduct(item.brand||'', item.name||'', priceText, imgSrc, badge||'');
                    });
                    // insert at beginning so newest appear first
                    grid.insertBefore(card, grid.firstChild);
                });
            }catch(e){ console.error('renderInventoryCards error', e); }
        }

        function getQueryParam(name){
            try{
                const params = new URLSearchParams(window.location.search);
                return params.get(name) || '';
            }catch(e){ return ''; }
        }

        function applyAllFilters(){
                const men = document.getElementById('genderMen') ? document.getElementById('genderMen').checked : true;
                const women = document.getElementById('genderWomen') ? document.getElementById('genderWomen').checked : true;
                const unisex = document.getElementById('genderUnisex') ? document.getElementById('genderUnisex').checked : true;
                const selectedEU = getSelectedEU();

                // gather selected brands (by value) - if none selected, show all brands
                const selectedBrands = Array.from(document.querySelectorAll('.brand-checkbox:checked')).map(b=>b.value.toString().toLowerCase());

                const cards = Array.from(document.querySelectorAll('.shoe-card'));
                let visibleCount = 0;
                const rawSearch = (document.getElementById('searchInput') ? document.getElementById('searchInput').value.trim() : '') || getQueryParam('search') || '';
                const searchTerm = rawSearch.toString().toLowerCase();

                cards.forEach(card => {
                    const gender = (card.getAttribute('data-gender') || '').toString();

                    // gender filtering: if no gender checkboxes are checked, treat as 'show all'
                    const anyGenderChecked = men || women || unisex;
                    let genderPass = true;
                    if(anyGenderChecked){
                        genderPass = ((men && gender === 'Men') || (women && gender === 'Women') || (unisex && gender === 'Unisex'));
                    }
                    if(!genderPass){ card.style.display = 'none'; return; }

                    // brand filtering
                    const prod = getCardProductInfo(card);
                    const brandName = (prod.brand || '').toString().toLowerCase();
                    if(selectedBrands.length > 0 && brandName){
                        if(selectedBrands.indexOf(brandName) === -1){ card.style.display = 'none'; return; }
                    }

                    // search filtering (match title or brand)
                    if(searchTerm){
                        const titleText = (prod.title || '').toString().toLowerCase();
                        // also check visible card text as fallback
                        const cardText = (card.textContent || '').toString().toLowerCase();
                        if(!(titleText.includes(searchTerm) || brandName.includes(searchTerm) || cardText.includes(searchTerm))){
                            card.style.display = 'none'; return;
                        }
                    }

                    // size filtering
                    if(selectedEU.length === 0){ card.style.display = ''; visibleCount++; return; }

                    const invRow = findInventoryForProduct(prod);
                    if(!invRow){ card.style.display = ''; visibleCount++; return; }

                    let sizeMatch = false;
                    for(const eu of selectedEU){
                        const qty = (invRow.sizes && (invRow.sizes[eu] !== undefined)) ? Number(invRow.sizes[eu]) : null;
                        if(qty !== null && qty > 0){ sizeMatch = true; break; }
                    }
                    card.style.display = sizeMatch ? '' : 'none';
                    if(sizeMatch) visibleCount++;
                });

                // update caption based on search
                try{
                    const capEl = document.getElementById('productlist-caption');
                    const clearBtn = document.getElementById('clearSearchBtn');
                    if(capEl){
                        if(rawSearch){
                            if(visibleCount > 0) capEl.textContent = `Showing ${visibleCount} product${visibleCount>1? 's':''} for "${rawSearch}"`;
                            else capEl.textContent = `No results found for "${rawSearch}"`;
                            if(clearBtn) clearBtn.style.display = 'block';
                        } else {
                            capEl.textContent = '';
                            if(clearBtn) clearBtn.style.display = 'none';
                        }
                    }
                }catch(e){ /* ignore caption errors */ }
        }

        window.addEventListener('storage', function(e){
            if(e.key === 'inventory' || e.key === 'sizeStandard' || e.key === 'selectedEU'){
                try{ if(e.key === 'inventory') renderInventoryCards(); }catch(_){}
                renderSizeButtons();
                applyAllFilters();
            }
        });

        document.addEventListener('DOMContentLoaded', function(){
            if(!localStorage.getItem('sizeStandard')) localStorage.setItem('sizeStandard','EU');
            if(!localStorage.getItem('selectedEU')) localStorage.setItem('selectedEU', JSON.stringify([]));
            renderSizeButtons();
            // render any admin-posted inventory cards
            try{ renderInventoryCards(); }catch(_){}
            // if a search param exists in URL, populate the nav search input so users can cancel/see it
            try{
                const raw = getQueryParam('search');
                const si = document.getElementById('searchInput');
                if(raw && si) si.value = raw;
            }catch(e){}
            applyAllFilters();
            // wire clear button
            try{
                const clearBtn = document.getElementById('clearSearchBtn');
                if(clearBtn){
                    clearBtn.addEventListener('click', function(){
                        const si = document.getElementById('searchInput');
                        if(si) si.value = '';
                        // remove search param from URL without reload
                        try{
                            const url = new URL(window.location.href);
                            url.searchParams.delete('search');
                            window.history.replaceState({}, '', url.pathname + url.search + url.hash);
                        }catch(e){}
                        applyAllFilters();
                        // hide caption/clear button
                        const cap = document.getElementById('productlist-caption');
                        if(cap) cap.textContent = '';
                        clearBtn.style.display = 'none';
                    });
                }
            }catch(e){}
            window.applyAllFilters = applyAllFilters;
        });
    })();
    // Initial filter: show all (use unified filter)
    window.addEventListener('DOMContentLoaded', function() {
        if (typeof applyAllFilters === 'function') applyAllFilters();
    });
    // When page regains focus (user navigates back here), refresh inventory cards and filters
    window.addEventListener('focus', function(){ try{ renderInventoryCards(); renderSizeButtons(); if(typeof applyAllFilters==='function') applyAllFilters(); }catch(e){} });
    document.addEventListener('visibilitychange', function(){ if(document.visibilityState==='visible'){ try{ renderInventoryCards(); renderSizeButtons(); if(typeof applyAllFilters==='function') applyAllFilters(); }catch(e){} } });
    </script>



        <footer class="footer-section">
            <div class="site-container">
                <div class="footer-row">
                    <div class="footer-left">
                        <div class="footer-header">Have questions?</div>
                        <div class="footer-subheader">Contact us at our facebook page</div>
                        <div class="footer-subheader" style="margin-top:18px;">Or via phone/email</div>
                        <div class="footer-divider"></div>
                        <div class="footer-note">All product names, logos, brands, trademarks, and registered trademarks are the property of their respective owners. All company, product, and service names used on this website are for identification purposes only. Use of these names, logos, and brands does not imply endorsement or affiliation.<br><br>© 2025 Shoe Pao Footwear. All rights reserved.</div>
                    </div>
                    <div class="footer-right">
                        <a href="#" class="footer-link">About Us</a>
                        <a href="#" class="footer-link">Shipping</a>
                        <a href="#" class="footer-link">Returns & Exchanges</a>
                        <a href="#" class="footer-link">Privacy Policy</a>
                        <a href="#" class="footer-link">Terms of Service</a>
                    </div>
                </div>
            </div>
        </footer>

    <!-- ===== ADDED: Cart Overlay + Sidebar HTML (from product-view.html) ===== -->
    <div id="cartOverlay" class="cart-overlay" aria-hidden="true"></div>
    <aside id="cartSidebar" class="cart-sidebar" aria-hidden="true" role="complementary">
        <div class="cart-header-row">
            <div>
                <span class="cart-header-title">Cart (<span id="cartCount">0</span>)</span>
            </div>
            <button id="closeCartBtn" class="cart-close" aria-label="Close cart"><img src="IMAGE/X.png" alt="Close" style="width:20px;height:20px;"></button>
        </div>
        <div class="cart-divider"></div>
        <div id="cartItems" class="cart-items">
            <div class="cart-empty">Your cart is empty</div>
        </div>
        <div class="cart-divider"></div>
        <div class="cart-subtotal-row">
            <span class="cart-subtotal-label">Subtotal</span>
            <span id="cartSubtotal" class="cart-subtotal-value">₱0.00</span>
        </div>
        <button id="checkoutBtn" class="cart-checkout-btn">Checkout</button>
    </aside>
    <!-- ===== ADDED: Cart Sidebar Behavior (from product-view.html) ===== -->
    <script>
    (function(){
        // cart data structure
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        // helpers
        function parsePriceToNumber(priceText) {
            if (!priceText) return 0;
            var v = priceText.replace(/[^0-9.]/g, '');
            return parseFloat(v || 0);
        }
        function formatPHP(amount) {
            try {
                return new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP' }).format(amount);
            } catch (e) {
                return '₱' + Number(amount).toFixed(2);
            }
        }
        function saveCartToLocalStorage() {
            localStorage.setItem('cart', JSON.stringify(cart));
        }
        // DOM refs
        const cartOverlay = document.getElementById('cartOverlay');
        const cartSidebar = document.getElementById('cartSidebar');
        const cartItemsContainer = document.getElementById('cartItems');
        const cartCountEl = document.getElementById('cartCount');
        const cartSubtotalEl = document.getElementById('cartSubtotal');
        const closeCartBtn = document.getElementById('closeCartBtn');
        const checkoutBtn = document.getElementById('checkoutBtn');
        // find nav cart button (the one with image alt="Cart")
        function getNavCartButton() {
            const img = document.querySelector('img[alt="Cart"]');
            if (!img) return null;
            return img.closest('button');
        }
        function openCartSidebar() {
            cartOverlay.classList.add('show');
            cartSidebar.classList.add('open');
            document.body.style.overflow = 'hidden';
            cartSidebar.setAttribute('aria-hidden', 'false');
            cartOverlay.setAttribute('aria-hidden', 'false');
        }
        function closeCartSidebar() {
            cartOverlay.classList.remove('show');
            cartSidebar.classList.remove('open');
            document.body.style.overflow = '';
            cartSidebar.setAttribute('aria-hidden', 'true');
            cartOverlay.setAttribute('aria-hidden', 'true');
        }
        function renderCart() {
            cartItemsContainer.innerHTML = '';
            if (cart.length === 0) {
                const empty = document.createElement('div');
                empty.className = 'cart-empty';
                empty.textContent = 'Your cart is empty';
                cartItemsContainer.appendChild(empty);
                cartCountEl.textContent = 0;
                cartSubtotalEl.textContent = formatPHP(0);
                // ensure packaging row is hidden/zero when empty
                var pkgRow = document.getElementById('cartPackagingRow'); if(pkgRow) pkgRow.style.display='none';
                var totalRow = document.getElementById('cartTotalRow'); if(totalRow) totalRow.style.display='none';
                saveCartToLocalStorage();
                return;
            }
            let subtotal = 0;
            let totalQty = 0;
            cart.forEach((item, index) => {
                const qty = (typeof item.qty === 'number') ? item.qty : (typeof item.quantity === 'number' ? item.quantity : 1);
                subtotal += item.price * qty;
                totalQty += qty;
                const box = document.createElement('div');
                box.className = 'cart-item-box';
                const img = document.createElement('img');
                img.className = 'cart-item-img';
                img.src = item.image || 'IMAGE/NIKE1.png';
                img.alt = item.title || 'Product';
                const middle = document.createElement('div');
                middle.className = 'cart-item-middle';
                const title = document.createElement('div');
                title.className = 'cart-item-title';
                title.textContent = item.title;
                const brand = document.createElement('div');
                brand.className = 'cart-item-brand';
                brand.textContent = item.brand;
                const size = document.createElement('div');
                size.className = 'cart-item-size';
                size.textContent = 'Size: ' + (item.size || '');
                const qtyControls = document.createElement('div');
                qtyControls.className = 'cart-quantity-controls';
                const lessenBtn = document.createElement('button');
                lessenBtn.className = 'qty-btn decrease';
                lessenBtn.setAttribute('data-index', index);
                const lessenImg = document.createElement('img');
                lessenImg.src = 'IMAGE/LessenBTN.png';
                lessenImg.alt = '-';
                lessenImg.style.width = '22px';
                lessenImg.style.height = '22px';
                lessenBtn.appendChild(lessenImg);
                const qtyText = document.createElement('span');
                qtyText.className = 'cart-item-qty';
                qtyText.textContent = qty;
                const addBtn = document.createElement('button');
                addBtn.className = 'qty-btn increase';
                addBtn.setAttribute('data-index', index);
                const addImg = document.createElement('img');
                addImg.src = 'IMAGE/AddBTN.png';
                addImg.alt = '+';
                addImg.style.width = '22px';
                addImg.style.height = '22px';
                addBtn.appendChild(addImg);
                qtyControls.appendChild(lessenBtn);
                qtyControls.appendChild(qtyText);
                qtyControls.appendChild(addBtn);
                middle.appendChild(title);
                middle.appendChild(brand);
                middle.appendChild(size);
                middle.appendChild(qtyControls);
                const removeBtn = document.createElement('button');
                removeBtn.className = 'cart-item-remove';
                removeBtn.setAttribute('data-index', index);
                const trashImg = document.createElement('img');
                trashImg.src = 'IMAGE/TrashIcon.png';
                trashImg.alt = 'Remove';
                trashImg.style.width = '18px';
                trashImg.style.height = '18px';
                removeBtn.appendChild(trashImg);
                const priceEl = document.createElement('div');
                priceEl.className = 'cart-item-price';
                priceEl.textContent = formatPHP(item.price * qty);
                box.appendChild(img);
                box.appendChild(middle);
                box.appendChild(removeBtn);
                box.appendChild(priceEl);
                cartItemsContainer.appendChild(box);
            });
            cartCountEl.textContent = totalQty;
            // compute packaging fee and totals
            var totals = { subtotal: subtotal, packaging: 0, total: subtotal };
            try{
                // Preferred: use helper if it's already loaded
                if(typeof window.getCartTotals === 'function'){
                    totals = window.getCartTotals(cart);
                } else {
                    // Fallback: compute packaging locally so fee appears even if cart-storage.js
                    // hasn't been loaded yet. Packaging: PHP50 per pair (every 2 items).
                    var totalItemsLocal = 0;
                    cart.forEach(function(item){ var q = (typeof item.qty==='number')?item.qty:((typeof item.quantity==='number')?item.quantity:1); totalItemsLocal += Number(q)||0; });
                    var pairsLocal = Math.floor(totalItemsLocal / 2);
                    var packagingLocal = pairsLocal * 50;
                    totals.subtotal = subtotal;
                    totals.packaging = packagingLocal;
                    totals.total = totals.subtotal + totals.packaging;
                    // attach helpful details for display
                    totals._pairs = pairsLocal;
                    totals._totalItems = totalItemsLocal;
                }
            }catch(e){ totals = { subtotal: subtotal, packaging: 0, total: subtotal }; }
            cartSubtotalEl.textContent = formatPHP(totals.subtotal);
            // create or update packaging row
            var pkgRow = document.getElementById('cartPackagingRow');
            if(!pkgRow){
                pkgRow = document.createElement('div'); pkgRow.id='cartPackagingRow'; pkgRow.className='cart-subtotal-row'; pkgRow.style.marginTop='6px';
                pkgRow.innerHTML = '<span class="cart-subtotal-label">Packaging Fee</span><span id="cartPackagingValue" class="cart-subtotal-value">₱0.00</span>';
                cartSubtotalEl.parentNode.parentNode.insertBefore(pkgRow, cartSubtotalEl.parentNode.nextSibling);
            }
            var pkgVal = document.getElementById('cartPackagingValue'); if(pkgVal) pkgVal.textContent = formatPHP(totals.packaging);
            // show explanation when packaging applies
            if(totals.packaging > 0){
                pkgRow.style.display = '';
                var expl = document.getElementById('cartPackagingExpl');
                if(!expl){ expl = document.createElement('div'); expl.id = 'cartPackagingExpl'; expl.style.fontSize='0.9rem'; expl.style.color='#666'; expl.style.marginTop='4px'; pkgRow.appendChild(expl); }
                var pairs = (typeof totals._pairs === 'number') ? totals._pairs : Math.floor((Number(cart.reduce(function(a,b){ var q=(typeof b.qty==='number')?b.qty:((typeof b.quantity==='number')?b.quantity:1); return a + (Number(q)||0); },0))) / 2);
                expl.textContent = 'Packaging fee: ₱50 per pair. You have ' + (totals._totalItems || cart.reduce(function(a,b){ var q=(typeof b.qty==='number')?b.qty:((typeof b.quantity==='number')?b.quantity:1); return a + (Number(q)||0); },0)) + ' item(s) → ' + pairs + ' pair(s).';
            } else {
                pkgRow.style.display = 'none';
            }
            // create or update total row
            var totalRow = document.getElementById('cartTotalRow');
            if(!totalRow){
                totalRow = document.createElement('div'); totalRow.id='cartTotalRow'; totalRow.className='cart-subtotal-row'; totalRow.style.marginTop='6px';
                totalRow.innerHTML = '<span class="cart-subtotal-label">Total</span><span id="cartTotalValue" class="cart-subtotal-value">₱0.00</span>';
                cartSubtotalEl.parentNode.parentNode.insertBefore(totalRow, cartSubtotalEl.parentNode.nextSibling.nextSibling);
            }
            // Cart modal should show only the shoes total (subtotal). Shipping/packaging handled at checkout.
            var totalVal = document.getElementById('cartTotalValue'); if(totalVal) totalVal.textContent = formatPHP(totals.subtotal);
            attachCartEvents();
        }
        function attachCartEvents() {
            // decrease
            document.querySelectorAll('.qty-btn.decrease').forEach(btn => {
                btn.onclick = function(e) {
                    const idx = parseInt(btn.getAttribute('data-index'), 10);
                    if (!isNaN(idx) && cart[idx]) {
                        // Use qty if present, else quantity
                        if (typeof cart[idx].qty === 'number') {
                            if (cart[idx].qty > 1) {
                                cart[idx].qty--;
                            }
                        } else if (typeof cart[idx].quantity === 'number') {
                            if (cart[idx].quantity > 1) {
                                cart[idx].quantity--;
                            }
                        }
                        renderCart();
                        saveCartToLocalStorage();
                    }
                };
            });
            // increase
            document.querySelectorAll('.qty-btn.increase').forEach(btn => {
                btn.onclick = function(e) {
                    const idx = parseInt(btn.getAttribute('data-index'), 10);
                    if (!isNaN(idx) && cart[idx]) {
                        if (typeof cart[idx].qty === 'number') {
                            cart[idx].qty++;
                        } else if (typeof cart[idx].quantity === 'number') {
                            cart[idx].quantity++;
                        }
                        renderCart();
                        saveCartToLocalStorage();
                    }
                };
            });
            // remove
            document.querySelectorAll('.cart-item-remove').forEach(btn => {
                btn.onclick = function(e) {
                    const idx = parseInt(btn.getAttribute('data-index'), 10);
                    if (!isNaN(idx)) {
                        cart.splice(idx, 1);
                        renderCart();
                        saveCartToLocalStorage();
                    }
                };
            });
        }
        // Hook nav cart button (remove its inline navigation and replace with open sidebar)
        document.addEventListener('DOMContentLoaded', function() {
            const navCartBtn = getNavCartButton();
            if (navCartBtn) {
                navCartBtn.removeAttribute('onclick');
                navCartBtn.addEventListener('click', function(e){
                    e.preventDefault();
                    openCartSidebar();
                });
            }
            // hook close buttons and overlay
            if (closeCartBtn) closeCartBtn.addEventListener('click', closeCartSidebar);
            if (cartOverlay) cartOverlay.addEventListener('click', closeCartSidebar);
            renderCart();
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', function(){
                    window.location.href = 'checkout.html';
                });
            }
        });
    })();
    </script>
    <script src="cart-storage.js"></script>
</body>
</html>
